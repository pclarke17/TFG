<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <script src="Camara-component.js"></script>
    <script src="video-component.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            height: 100%;
            background-color: #f0f0f0;
        }
        #menu, #source-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #ffffff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            border-radius: 10px;
        }
        #menu button, #source-menu button {
            margin: 15px;
            padding: 15px 30px;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #menu button:hover, #source-menu button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="source-menu">
        <h1>Elige la Fuente de Transmisión</h1>
        <button id="camara">Cámara en Vivo</button>
        <button id="video">Video Almacenado</button>
    </div>

    <div id="menu" style="display: none;">
        <h1>Elige una Opción</h1>
        <button id="transmitir">Transmitir</button>
        <button id="recibir">Recibir</button>
    </div>

    <!-- La escena de A-Frame -->
    <a-scene id="aframe-scene" style="display: none;">
        <!-- Sala de control con una pantalla y algunos controles -->
        <!-- Pantalla para ver la cámara o video -->
        <a-box id="video-box" geometry="primitive: plane; width: 4; height: 2" position="0 1.5 -3" material="color: #000000"></a-box>
        
        <!-- Consolas de control en la sala -->
        <a-box position="-1.5 0.75 -2.5" depth="0.5" width="1.5" height="0.5" color="#4b4b4b"></a-box>
        <a-box position="1.5 0.75 -2.5" depth="0.5" width="1.5" height="0.5" color="#4b4b4b"></a-box>
        <a-box position="0 0.5 -2.8" depth="0.2" width="4" height="0.3" color="#b0b0b0"></a-box>
        
        <!-- Paredes de la sala para dar la impresión de estar dentro -->
        <a-box position="0 1.5 -4.5" depth="0.1" width="8" height="3" color="#b0b0b0"></a-box> <!-- Pared frontal -->
        <a-box position="-4 1.5 -2.5" depth="0.1" width="5" height="3" rotation="0 90 0" color="#b0b0b0"></a-box> <!-- Pared izquierda -->
        <a-box position="4 1.5 -2.5" depth="0.1" width="5" height="3" rotation="0 90 0" color="#b0b0b0"></a-box> <!-- Pared derecha -->
        <a-box position="0 3 -2.5" depth="5" width="8" height="0.1" color="#b0b0b0"></a-box> <!-- Techo -->
        
        <!-- Suelo de la sala -->
        <a-plane rotation="-90 0 0" width="8" height="5" color="#808080" position="0 0 -2.5"></a-plane>
    </a-scene>

    <script>
        let selectedSource = null;

        // Manejar el menú de selección de fuente
        document.getElementById('camara').addEventListener('click', function () {
            selectedSource = 'c';
            document.getElementById('source-menu').style.display = 'none';
            document.getElementById('menu').style.display = 'flex';
        });

        document.getElementById('video').addEventListener('click', function () {
            selectedSource = 'v';
            document.getElementById('source-menu').style.display = 'none';
            document.getElementById('menu').style.display = 'flex';
        });

        // Manejar el menú de selección de rol
        document.getElementById('transmitir').addEventListener('click', function () {
            if (selectedSource === 'c' || selectedSource === 'v') {
                iniciarEscena('transmitter', selectedSource);
            } else {
                alert("Por favor, selecciona una fuente de transmisión antes.");
            }
        });

        document.getElementById('recibir').addEventListener('click', function () {
            iniciarEscena('receiver');
        });

        function iniciarEscena(role, source = null) {
            // Ocultar el menú
            document.getElementById('menu').style.display = 'none';
            // Mostrar la escena de A-Frame
            const scene = document.getElementById('aframe-scene');
            scene.style.display = "block";

            if (role === 'transmitter') {
                if (source === 'c') {
                    // Empezar como transmisor usando la cámara en vivo
                    document.querySelector('#video-box').setAttribute('camera-canvas-texture', 'role: transmitter');
                } else if (source === 'v') {
                    // Empezar como transmisor usando un video almacenado
                    document.querySelector('#video-box').setAttribute('camera-canvas-texture1', 'role: transmitter; useVideo: true');
                }
            } else if (role === 'receiver') {
                // Empezar como receptor
                document.querySelector('#video-box').setAttribute('camera-canvas-texture1', 'role: receiver');
            }
        }
    </script>
</body>
</html>
